<!-- https://latex-editor.pages.dev/formatter/ -->

# 组合数学1

### 分类加法计数原理

### 分步乘法计数原理

### 排列数

从 $n$ 个不同的元素中，选择 $m$ 个，排成一列，列内有顺序区别，有多少种不同的方案。

$$
\begin{align}
	P_{n}^{m} & = n(n-1)(n-2)\cdots(n-m+1)\nonumber \\
	          & = \frac{n!}{(n-m)!}\nonumber
\end{align}
$$

全排列

$$
\begin{align}
	P_{n}^{n} & = n(n-1)(n-2)\cdots3\times2\times1\nonumber \\
	          & = n!\nonumber
\end{align}
$$

由于阶乘的符号比较好写也比较好理解，所以一般都直接将全排列写作阶乘的形式。

### 组合数

从 $n$ 个不同的元素中，选择 $m$ 个，选出一组，组内没有顺序区别，有多少种不同的方案。

由于组内没有顺序区别，可以除掉组内元素的全排列。

$$
\begin{align}
	C_{n}^{m} & = \frac{P_{n}^{m}}{P_{m}^{m}}\nonumber                                       \\
	          & = \frac{n(n-1)(n-2)\cdots(n-m+1)}{m(m-1)(m-2)\cdots3\times2\times1}\nonumber \\
	          & = \frac{n!}{(n-m)!m!}\nonumber
\end{align}
$$

## 排列组合技巧

### 可重元素的排列

$n_a$ 个相同的元素A， $n_b$ 个相同的元素B， $n_c$ 个相同的元素C的全排列。

要除掉每个种类的元素内部的顺序关系，也就是除以他们分别的全排列。

$$ans = \frac{(n_a + n_b + n_c)!}{n_a!n_b!n_c!}$$

可以推广到 $k$ 种元素：

$$ans = \frac{(\sum_{i=1}^{k}n_i)!}{\prod_{i=1}^{k}(n_i!)}$$

### 可重元素的组合

$n_a$ 个相同的元素A， $n_b$ 个相同的元素B， $n_c$ 个相同的元素C，从中选出 $m$ 个有多少种不同的组合。

这个问题比可重元素的排列复杂很多。

最简单的方法，用生成函数，求多项式

$$P(x) = (1 + x + x^2 + \cdots + x^{n_a})(1 + x + x^2 + \cdots + x^{n_b})(1 + x + x^2 + \cdots + x^{n_c})$$

中，次数为 $m$ 的项，也就是 $x^m$ 的系数。

非常容易推广到 $k$ 种元素

$$P(x) = \prod_{i=1}^{k}(1 + x + x^2 + \cdots + x^{n_i})$$

可以使用快速傅里叶变换（FFT）求解。对于特定的问题（模 $998244353$ ），也可以使用数论变换（NTT）求解。

如果每一种元素的数量都是无限，问题会变简单，从 $k$ 种不同的元素中，选择 $m$ 个，有多少种组合？等价于向 $k$ 个不同的盒子中，放入一共 $m$ 个球，也就是经典的可空盒子的隔板法问题，方案数为 $C_{m+k-1}^{m} = C_{m+k-1}^{k - 1}$

### 插入法

### 捆绑法

### 剩余法

### 对等法

### 排异法

### 隔板法

有 $n$ 个相同的小球， $m$ 个不同的盒子。每个盒子可以为空。有多少种放置方法？很简单，抽象出 $m-1$个隔板，和小球一起全排列，得到 $P_{n+m-1}^{n+m-1} = (n+m-1)!$ ，最后在两端加上额外的两个隔板，分隔出一共 $m$ 个组，把对应组的小球放入对应的盒子中即可。注意小球和隔板是完全相同的，所以应用可重元素的排列问题，除以他们的全排列 $P_{n}^{n} = n!$ 和 $P_{m-1}^{m-1} = (m-1)!$ ，得到的也就是 $\frac{(n+m-1)!}{n!(m-1)!} = C_{n+m-1}^{n} = C_{n+m-1}^{m-1}$。

或者，在总共 $n+m-1$ 个位置中，为 $n$ 个小球或者 $m-1$ 个隔板选择他们的位置，直接变成组合数问题。

如果要求每个盒子必须非空呢？




## 其他排列组合


### 圆排列

从 $n$ 个不同的元素中，选择 $m$ 个，排成一个圆环，圆环内有顺序区别，有多少种不同的方案。

相当于钦定了起点位置的排列，由于一共有 $m$ 个位置，钦定某个元素一定排在起点，其他元素就是普通的排列。

$$
\begin{align}
	ans_{n}^{m} & =\frac{P_{n}^{m}}{m}\nonumber    \\
\end{align}
$$

 $n$ 个元素的圆排列

$$
\begin{align}
	ans_{n}^{n} & =\frac{P_{n}^{n}}{n} \nonumber    \\
	          & = (n-1)!\nonumber
\end{align}
$$

所以也有 $ans_{n}^{n} = P_{n-1}^{n-1}$ 

也可用 Polya 定理获得。

### 错位排列

有 $n$ 个不同的元素，给他们当前的位置编号为 $1,2,3,\cdots,n$ 以区分他们的位置，问有多少种排列方案使得他们不在原来的位置上。或者说，使得第 $i$ 个位置的元素编号不为 $i$ 。

显然，如果只有 $0,1,2$ 个元素，他们的情况是显然的。

考虑新增第 $n(n\geq3)$ 个元素，我们可以任选前面的 $n-1$ 个位置放置它，假设我们选择的是第 $k$ 个位置，再考虑元素 $k$ 如何安放，如果 $k$ 放在第 $n$ 个位置，那么这一对元素的位置要求都已经被满足了，并且对其他元素都没有产生任何影响，问题规模缩减到 $n-2$ ；如果 $k$ 不放在第 $n$ 个位置，那么排除掉已被元素 $n$ 占据的位置 $k$ ，现在还有 $n-1$ 个元素，并且每一个元素都有自己不能去的一个位置（对于 $i\neq k$ 来说，他们不能去位置 $i$ ，而对于元素 $k$ 来说，它不能去位置 $n$ ），这相当于是一个问题规模为 $n-1$ 的问题。这个算法也可以合并到 $n=2$ 的情况上，所以：

$$
D_n = \left \{ 
    \begin{aligned}
&1 &(n = 0)\\ 
&0 & (n=1)\\
&(n-1)(D_{n-1}+D_{n-2})& (n\geq2) 
\end{aligned}
\right. $$

于是得到了一个 $O(n)$ 的递推算法。

另一个计算公式（计算复杂度还更高了，不必要学习）

$$
D_n = \left \{ 
    \begin{aligned}
&1 &(n = 0)\\ 
&0 & (n=1)\\
&n! \sum_{i=2}^{n}\frac{(-1)^k}{k!}& (n\geq2) 
\end{aligned}
\right. $$


### 卡特兰数

组合数学的问题都尽量考虑如何从规模更小一级的问题得到，
比如用 $O(n^2)$ 的方法算出来。
