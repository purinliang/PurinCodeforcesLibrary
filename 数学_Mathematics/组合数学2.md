<!-- https://latex-editor.pages.dev/formatter/ -->

# 组合数学2


### 二项式反演

设 $F_i$ 为恰好用 $i$ 个不同的元素形成某个结构的方案数，而 $G_n$ 为从 $n$ 个不同的元素中选出任意多个 $i\geq 0$ 个元素形成某个结构的方案数。

很显然， $G_n$ 可以通过枚举 $i$ 然后从 $F_i$ 计算。

$$G_n = \sum_{i=0}^{n}C_n^{i}\cdot F_i$$

如果反过来，已知 $G_i$ 的值，求 $F_n$ 的值，为

$$F_n = \sum_{i=0}^{n}C_n^{i}\cdot (-1)^{n-i} \cdot G_i$$


### 第一类斯特林数 / 斯特林轮换数

### 第二类斯特林数 / 斯特林子集数

还记得把 $n$ 个相同的小球放到 $m$ 个不同的盒子里的问题吗？这个是用隔板法解决的问题。

其实这个第二类斯特林数比第一类斯特林数常见，也更早被发现。

第二类斯特林数跟这个恰好相反，是把 $n$ 个不同的小球，放到 $m$ 个相同的盒子里，并且每个盒子**非空**。

记作大写S的 $S(n,m)$

边界 $S(n,0) = [n=0]$ 也就是说 $S(0,0)=1$ 否则 $S(n,0)=0,(n\geq 1), S(n,k) = 0,(k>n)$

考虑如果已经计算出了 $S(n-1,m-1)$ 的答案，考虑如何计算出 $S(n,m)$

首先，第n个小球可以从盒子里选择其中一个独占，由于盒子是相同的所以不需要乘以 $m$，其他小球去用剩余的 $m-1$ 个盒子，这里贡献是 $S(n-1,m-1)$

否则，第 $n$ 个小球必须和其他小球共用盒子，由于第 $n$ 个球不是独占的情况，所以其他盒子一定是非空的，从 $m$ 个有球的盒子中随便选一个加入，也就是贡献为 $m\cdot S(n-1,m)$

综上所述，答案为 $S(n,m) = S(n-1,m-1) + m\cdot S(n-1,m)$

通项公式，要看二项式反演，有点难理解，还是直接记住吧，注意有一个次方是 $n$ ，同样要意识到 $n\geq m$ 一定成立。

$$S(n,m)=\sum_{i=0}^{m}\frac{(-1)^{m-i}i^n}{i!(m-i)!}$$

这个通项公式一定可以用 $O(\log{n} + m)$ 的复杂度进行计算。

这是一个**卷积**的形式，$i$ 从 $0$ 到 $m$ ，每一项中有 $i$ 和 $m-i$ 的交叉项。

设多项式

$$S_1(x)=\sum_{i=0}^{n}\frac{i^n}{i!}x^i$$

和多项式

$$S_2(x)=\sum_{j=0}^{n}\frac{(-1)^{j}}{j!}x^j$$

对他们进行多项式乘法，得到

$$S(x)=S_1(x)\cdot S_2(x)$$

其 $x^m$ 的系数，即为两个多项式中 $i+j=m$ 的所有项的系数之和，也就是一个**卷积**。

注意到其实 $n\geq m$ ，对于同一个 $n$，可以一次得到不同的 $m$ 对应的结果。计算复杂度为 $O(\log{n})$ 计算 $i^n$ 的值，$O(n)$ 构造长度为 $n$ 的多项式，把他们 $O(n\log{n})$乘起来，得到的系数就是同一行的第二类斯特林数。

同一列的第二类斯特林数计算

对于同一个m（盒子数）以及不同的n（球数），求出所有的第二类斯特林数。

要用到指数型生成函数。


## 生成函数

生成函数尤其适合用来求解带有奇怪限制条件的组合数问题。

经典的组合数，每个元素选择或者不选择，对应二项式

$$(1+x)$$

如果取 $1 = x^0$ 表示选取 $0$ 个这样的元素。
如果取 $x = x^1$ 表示选取 $1$ 个这样的元素。

假如有 $n$ 个完全一样的元素，从中选择 $m$ 个，那么就相当于 $n$ 个这样的二项式相乘：

$$P(x)=\prod_{i=1}^{n}(1+x)$$

其中 $x^m$ 的项的系数，就是从所有的 $n$ 个二项式中，组合出 $m$ 个 $x$ 和 $n-m$ 个 $1$ 得到的，也就是 $C_n^{m}$ 。

目前看到这里，感觉还是没有什么用处对吧？

对于可重复元素的组合，比如有 $a$ 个元素A， $b$ 个元素B， $c$ 个元素C，从中选出 $m$ 个元素，有多少种组合？

对于元素A，我们可以从中选择 $[0, a]$ 个，对应多项式

$$(1+x+x^2+\cdots+x^a)$$

同理，元素B和元素C的多项式为

$$(1+x+x^2+\cdots+x^b) \\
(1+x+x^2+\cdots+x^c)$$

把他们乘起来，得到

$$P(x)=(1+x+x^2+\cdots+x^a)(1+x+x^2+\cdots+x^b)(1+x+x^2+\cdots+x^c)$$

从中取出 $x^m$ 项的系数，不就相当于从三类物品中总共选出了 $m$ 个物品了吗？

除此之外，生成函数还可以解决很多更奇怪的问题，比如，如果限制元素A的数量只能选择偶数个，那么就是

$$(1+x^2+x^4\cdots+x^{\lfloor\frac{a}{2}\rfloor})$$

同理还能选择奇数个，3的倍数个，5的倍数个等奇怪的限制。

或者偏偏不能选某个数量的，比如我们不喜欢数字4，那么就把 $x^4$ 这一项去掉。

计算这种多项式的方法，需要用到快速傅里叶变换（FFT）。

### 整数分拆

把正整数 $n$ 分解成若干个正整数的加法组合，分解出来的结果是顺序无关的，比如 $5=3+1+1$ 和 $5=1+1+3$ 其实是同样的方案，问有多少种方案。

比如 $4$ 的分拆为：

$$
4 \\
3 + 1 \\
2 + 2 \\
2 + 1 + 1 \\
1 + 1 + 1 + 1 \\
$$

总共5种方案。

特别地，0的分拆方案是只有1种，也就是空。

最简单的解决方法，生成函数！

比如我们要计算 $4$ 的分拆，那么我们考虑，要拆出多少个数字1？

$$(1+x+x^2+x^3+x^4)$$

每选择多一个x，则多拆出一个数字1。

对于数字2，要么不选择，要么一次选2个、4个，还记得前面的只能选偶数的写法吗？

$$(1+x^2+x^4)$$

对于数字3，只能拆出3的倍数。

$$(1+x^3)$$

对于数字4，只有他本身了

$$(1+x^4)$$

把这些全部乘在一起，得到

$$P(x)=(1+x+x^2+x^3+x^4)(1+x^2+x^4)(1+x^3)(1+x^4)$$

其中取出 $x^4$ 的项的系数，即为答案。

生成函数还可以全体乘以、部分乘以 $x$ 或者 $x^{-1}$ 表示添加或者移除某一些元素，具体要看题目的要求，上一次一到CF的题目就是这样。
