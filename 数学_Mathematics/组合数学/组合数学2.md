<!-- https://latex-editor.pages.dev/formatter/ -->

# 组合数学2


### 二项式反演

设 $F_i$ 为恰好用 $i$ 个不同的元素形成某个结构的方案数，而 $G_n$ 为从 $n$ 个不同的元素中选出任意多个 $i\geq 0$ 个元素形成某个结构的方案数。

很显然， $G_n$ 可以通过枚举 $i$ 然后从 $F_i$ 计算。

$$G_n = \sum_{i=0}^{n}C_n^{i}\cdot F_i$$

如果反过来，已知 $G_i$ 的值，求 $F_n$ 的值，为

$$F_n = \sum_{i=0}^{n}C_n^{i}\cdot (-1)^{n-i} \cdot G_i$$


### 第一类斯特林数 / 斯特林轮换数

### 第二类斯特林数 / 斯特林子集数

还记得把 $n$ 个相同的小球放到 $m$ 个不同的盒子里的问题吗？这个是用隔板法解决的问题。

其实这个第二类斯特林数比第一类斯特林数常见，也更早被发现。

第二类斯特林数跟这个恰好相反，是把 $n$ 个不同的小球，放到 $m$ 个相同的盒子里，并且每个盒子**非空**。

记作大写S的 $S(n,m)$

边界 $S(n,0) = [n=0]$ 也就是说 $S(0,0)=1$ 否则 $S(n,0)=0,(n\geq 1), S(n,k) = 0,(k>n)$

考虑如果已经计算出了 $S(n-1,m-1)$ 的答案，考虑如何计算出 $S(n,m)$

首先，第n个小球可以从盒子里选择其中一个独占，由于盒子是相同的所以不需要乘以 $m$，其他小球去用剩余的 $m-1$ 个盒子，这里贡献是 $S(n-1,m-1)$

否则，第 $n$ 个小球必须和其他小球共用盒子，由于第 $n$ 个球不是独占的情况，所以其他盒子一定是非空的，从 $m$ 个有球的盒子中随便选一个加入，也就是贡献为 $m\cdot S(n-1,m)$

综上所述，答案为 $S(n,m) = S(n-1,m-1) + m\cdot S(n-1,m)$

通项公式，要看二项式反演，有点难理解，还是直接记住吧，注意有一个次方是 $n$ ，同样要意识到 $n\geq m$ 一定成立。

$$S(n,m)=\sum_{i=0}^{m}\frac{(-1)^{m-i}i^n}{i!(m-i)!}$$

这个通项公式一定可以用 $O(\log{n} + m)$ 的复杂度进行计算。

这是一个**卷积**的形式，$i$ 从 $0$ 到 $m$ ，每一项中有 $i$ 和 $m-i$ 的交叉项。

设多项式

$$S_1(x)=\sum_{i=0}^{n}\frac{i^n}{i!}x^i$$

和多项式

$$S_2(x)=\sum_{j=0}^{n}\frac{(-1)^{j}}{j!}x^j$$

对他们进行多项式乘法，得到

$$S(x)=S_1(x)\cdot S_2(x)$$

其 $x^m$ 的系数，即为两个多项式中 $i+j=m$ 的所有项的系数之和，也就是一个**卷积**。

注意到其实 $n\geq m$ ，对于同一个 $n$，可以一次得到不同的 $m$ 对应的结果。计算复杂度为 $O(\log{n})$ 计算 $i^n$ 的值，$O(n)$ 构造长度为 $n$ 的多项式，把他们 $O(n\log{n})$乘起来，得到的系数就是同一行的第二类斯特林数。

同一列的第二类斯特林数计算

对于同一个m（盒子数）以及不同的n（球数），求出所有的第二类斯特林数。

要用到指数型生成函数。


## 生成函数

普通型生成函数，用来生成一个序列，可以是有穷序列也可以是无穷序列，x的i次方（也就是i次方项）的系数就是代表这个数列第i项的值（这里的数列以0为首项）

下面认为 $A(x)$ 是序列 $a$ 的生成函数， $B(x)$ 是序列 $b$ 的生成函数。

对于形如 $c_i=a_i+b_i$ 的序列，由于是要将相同项的系数相加，对于多项式，相同项的系数是自然合并的，所以 $C(x) = A(x) + B(x)$

对于如果a和b都是长度为n+1的多项式（最高次为n，最低次为0），对于形如 $c_i=\sum\limits_{j=0}^{i}a_jb_{i-j}$ 的序列，并不是把b倒转之后，与a逐个相乘。注意每一个项等于一系列下标和等于该项的两个项的积，这与多项式的乘法类似，所以 $C(x) = A(x) \cdot B(x) \mod {x^{n+1}}$ 后面这个取模的意思是，仅保留前面的[0,n]次项，或者，在形式幂级数的展开形式中，只求和[0, n]次项，其他的丢掉，这是相同的意思。

在很多dp，尤其是组合数学的计数问题中，规模为n的问题，可以枚举分为两个部分，也就是左部规模为i，右部规模为n-i，或者考虑新增的第n个点作为切分点，也就是左部规模为i，中间为新元素n，右边规模为n-1-i，左右部之间是分步乘法计数原理，枚举的不同的i之间是分类加法计数原理。所以在组合数学中，经常会用到这个卷积的形式。

对于无穷序列，上面这个表达：

$$P(x) = \sum\limits_{i=0}^{\infin} a_i \cdot x^i$$ 

称为幂级数的形式。

有时候我们不想要这个幂级数了，可以通过错位相减或者其他方法让它们互相消除掉。

如最简单的序列

$$P(x) = 1+x+x^2+x^3+\cdots \\
= \sum\limits_{i=0}^{\infin}  x^i$$

显然

$$x\cdot P(x) = x + x^2 + x^3 + x^4 + \cdots$$
$$x\cdot P(x) - P(x) = P(x) \cdot (x - 1)\\ = (x + x^2 + x^3 + x^4 + \cdots) - (1+x+x^2+x^3+\cdots) \\
= - 1$$

所以
$$P(x) = \frac{1}{1-x}$$

这个称为生成函数的封闭形式。

考虑等比数列


$$P(x) = 1+px+p^2x^2+p^3x^3+\cdots \\
= \sum\limits_{i=0}^{\infin}  p^ix^i$$

$$px\cdot P(x) = px + p^2x^2 + p^3x^3 + p^4x^4 + \cdots$$
$$px\cdot P(x) - P(x) = P(x) \cdot (px - 1)\\ = (px + p^2x^2 + p^3x^3 + p^4x^4 + \cdots) - (1+px+p^2x^2+p^3x^3+\cdots) \\
= - 1$$

所以
$$P(x) = \frac{1}{1-px}$$


对于数列 $$[0,1,1,1,\cdots]$$

形式幂级数是显然的
$$P(x) = x + x^2 + x^3 + \cdots$$
$$xP(x) = x^2 + x^3 + x^4 + \cdots$$

$$(x-1)P(x)=-x$$
$$P(x) = \frac{x}{1-x}$$

对于数列 $$[0,1,0,1,\cdots]$$
形式幂级数是显然的
$$P(x) = x + x^3 + x^5 + \cdots$$
$$x^2P(x) = x^3 + x^5 + x^7 + \cdots$$
$$P(x) = \frac{x}{1-x^2}$$

对于数列 $$[1,0,1,0,\cdots]$$
形式幂级数是显然的
$$P(x) = 1 + x^2 + x^4 + \cdots$$
$$x^2P(x) = x^2 + x^4 + x^6 + \cdots$$
$$P(x) = \frac{1}{1-x^2}$$

这部分太难了，太过于数学了，封闭形式其实可以理解为递推形式，可以反过来求形式幂级数，也就是通项公式。

---


生成函数尤其适合用来求解带有奇怪限制条件的组合数问题。

经典的组合数，每个元素选择或者不选择，对应二项式

$$(1+x)$$

如果取 $1 = x^0$ 表示选取 $0$ 个这样的元素。
如果取 $x = x^1$ 表示选取 $1$ 个这样的元素。

假如有 $n$ 个完全一样的元素，从中选择 $m$ 个，那么就相当于 $n$ 个这样的二项式相乘：

$$P(x)=\prod_{i=1}^{n}(1+x)$$

其中 $x^m$ 的项的系数，就是从所有的 $n$ 个二项式中，组合出 $m$ 个 $x$ 和 $n-m$ 个 $1$ 得到的，也就是 $C_n^{m}$ 。

目前看到这里，感觉还是没有什么用处对吧？

对于可重复元素的组合，比如有 $a$ 个元素A， $b$ 个元素B， $c$ 个元素C，从中选出 $m$ 个元素，有多少种组合？

对于元素A，我们可以从中选择 $[0, a]$ 个，对应多项式

$$(1+x+x^2+\cdots+x^a)$$

同理，元素B和元素C的多项式为

$$(1+x+x^2+\cdots+x^b) \\
(1+x+x^2+\cdots+x^c)$$

把他们乘起来，得到

$$P(x)=(1+x+x^2+\cdots+x^a)(1+x+x^2+\cdots+x^b)(1+x+x^2+\cdots+x^c)$$

从中取出 $x^m$ 项的系数，不就相当于从三类物品中总共选出了 $m$ 个物品了吗？

除此之外，生成函数还可以解决很多更奇怪的问题，比如，如果限制元素A的数量只能选择偶数个，那么就是

$$(1+x^2+x^4\cdots+x^{\lfloor\frac{a}{2}\rfloor})$$

同理还能选择奇数个，3的倍数个，5的倍数个等奇怪的限制。

或者偏偏不能选某个数量的，比如我们不喜欢数字4，那么就把 $x^4$ 这一项去掉。

计算这种多项式的方法，需要用到快速傅里叶变换（FFT）。

### 整数分拆

把正整数 $n$ 分解成若干个正整数的加法组合，分解出来的结果是顺序无关的，比如 $5=3+1+1$ 和 $5=1+1+3$ 其实是同样的方案，问有多少种方案。

比如 $4$ 的分拆为：

$$
4 \\
3 + 1 \\
2 + 2 \\
2 + 1 + 1 \\
1 + 1 + 1 + 1 \\
$$

总共5种方案。

特别地，0的分拆方案是只有1种，也就是空。

最简单的解决方法，生成函数！

比如我们要计算 $4$ 的分拆，那么我们考虑，要拆出多少个数字1？

$$(1+x+x^2+x^3+x^4)$$

每选择多一个x，则多拆出一个数字1。

对于数字2，要么不选择，要么一次选2个、4个，还记得前面的只能选偶数的写法吗？

$$(1+x^2+x^4)$$

对于数字3，只能拆出3的倍数。

$$(1+x^3)$$

对于数字4，只有他本身了

$$(1+x^4)$$

把这些全部乘在一起，得到

$$P(x)=(1+x+x^2+x^3+x^4)(1+x^2+x^4)(1+x^3)(1+x^4)$$

其中取出 $x^4$ 的项的系数，即为答案。

生成函数还可以全体乘以、部分乘以 $x$ 或者 $x^{-1}$ 表示添加或者移除某一些元素，具体要看题目的要求，上一次一到CF的题目就是这样。

## 指数型生成函数

指数型生成函数是用来求带有二项式系数的卷积的通项公式的数列的？

序列 $a$ 的指数型生成函数的形式幂级数为
$$ F(x) = \sum\limits_{i=0}^{n} a_i \cdot \frac{x^i}{i!}  $$

这里并不是说要求序列 $a$ 的通项公式带有 $\frac{1}{i!}$ ，而是这个指数型生成函数自带的，而且一般把 $\frac{1}{i!}$ 放在 $x^i$ 的下面表示他们都并不是序列的一部分。

指数型生成函数的加减法和普通型生成函数的比较类似，同样位置的项直接加减就可以了。

但是对于卷积（乘法），会有不一样的表现。考虑另一个序列
$$ G(x) = \sum\limits_{i=0}^{n} b_i \cdot \frac{x^i}{i!} $$
$$ F(x)\cdot G(x) = \sum\limits_{i=0}^{n} (\sum\limits_{j=0}^{i}a_jb_{i-j} \cdot \frac{x^i}{j!(i-j)!})   \\ = \sum\limits_{i=0}^{n} \frac{x^i}{i!} (\sum\limits_{j=0}^{i}a_jb_{i-j} \cdot \frac{i!}{j!(i-j)!}) $$

由公式 
$$C(i,j) = \frac{i!}{j!(i-j)!}$$

得到
$$ F(x)\cdot G(x) = \sum\limits_{i=0}^{n} \frac{x^i}{i!} \sum\limits_{j=0}^{i}a_jb_{i-j}C(i,j) $$

也就是说，他们乘法的结果，为序列 $c_i=\sum\limits_{j=0}^{i}a_jb_{i-j}C(i,j)$ 的结果。

代入 $a_i = 1$ 和 $b_i = 1$ 两个序列，卷积得到的结果就是熟悉的二项式系数，确实没啥问题。

其实，
$$ F(x) = \sum\limits_{i=0}^{n} a_i \cdot \frac{x^i}{i!}  $$
是序列 $a_i$ 的指数型生成函数，也是序列 $\frac{a_i}{i!}$ 的普通型生成函数。
