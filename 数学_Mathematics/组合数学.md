<!-- https://latex-editor.pages.dev/formatter/ -->

### 分类加法计数原理

### 分步乘法计数原理

### 排列数

从 $n$ 个不同的元素中，选择 $m$ 个，排成一列，列内有顺序区别，有多少种不同的方案。

$$
\begin{align}
	P_{n}^{m} & = n(n-1)(n-2)\cdots(n-m+1)\nonumber \\
	          & = \frac{n!}{(n-m)!}\nonumber
\end{align}
$$

全排列

$$
\begin{align}
	P_{n}^{n} & = n(n-1)(n-2)\cdots3\times2\times1\nonumber \\
	          & = n!\nonumber
\end{align}
$$

由于阶乘的符号比较好写也比较好理解，所以一般都直接将全排列写作阶乘的形式。

### 组合数

从 $n$ 个不同的元素中，选择 $m$ 个，选出一组，组内没有顺序区别，有多少种不同的方案。

由于组内没有顺序区别，可以除掉组内元素的全排列。

$$
\begin{align}
	C_{n}^{m} & = \frac{P_{n}^{m}}{P_{m}^{m}}\nonumber                                       \\
	          & = \frac{n(n-1)(n-2)\cdots(n-m+1)}{m(m-1)(m-2)\cdots3\times2\times1}\nonumber \\
	          & = \frac{n!}{(n-m)!m!}\nonumber
\end{align}
$$


## 排列组合技巧

### 可重元素的排列

$n_a$ 个相同的元素A， $n_b$ 个相同的元素B， $n_c$ 个相同的元素C的全排列。

要除掉每个种类的元素内部的顺序关系，也就是除以他们分别的全排列。

$$ans = \frac{(n_a + n_b + n_c)!}{n_a!n_b!n_c!}$$

可以推广到 $k$ 种元素：

$$ans = \frac{(\sum_{i=1}^{k}n_i)!}{\prod_{i=1}^{k}(n_i!)}$$

### 可重元素的组合

$n_a$ 个相同的元素A， $n_b$ 个相同的元素B， $n_c$ 个相同的元素C，从中选出 $m$ 个有多少种不同的组合。

最简单的方法，用生成函数，求多项式

$$P(x) = (1 + x + x^2 + \cdots + x^{n_a})(1 + x + x^2 + \cdots + x^{n_b})(1 + x + x^2 + \cdots + x^{n_c})$$

中，次数为 $m$ 的项，也就是 $x^m$ 的系数。

非常容易推广到 $k$ 种元素

$$P(x) = \prod_{i=1}^{k}(1 + x + x^2 + \cdots + x^{n_i})$$

可以使用快速傅里叶变换（FFT）求解。对于特定的问题（模 $998244353$ ），也可以使用数论变换（NTT）求解。

如果每一种元素的数量都是无限，问题会变简单，从 $k$ 种不同的元素中，选择 $m$ 个，有多少种组合？等价于向 $k$ 个不同的盒子中，放入一共 $m$ 个球，也就是经典的可空盒子的隔板法问题，方案数为 $C_{m+k-1}^{m} = C_{m+k-1}^{k - 1}$

### 插入法

### 捆绑法

### 剩余法

### 对等法

### 排异法

### 隔板法

有 $n$ 个相同的小球， $m$ 个不同的盒子。每个盒子可以为空。有多少种放置方法？很简单，抽象出 $m-1$个隔板，和小球一起全排列，得到 $P_{n+m-1}^{n+m-1} = (n+m-1)!$ ，最后在两端加上额外的两个隔板，分隔出一共 $m$ 个组，把对应组的小球放入对应的盒子中即可。注意小球和隔板是完全相同的，所以应用可重元素的排列问题，除以他们的全排列 $P_{n}^{n} = n!$ 和 $P_{m-1}^{m-1} = (m-1)!$ ，得到的也就是 $\frac{(n+m-1)!}{n!(m-1)!} = C_{n+m-1}^{n} = C_{n+m-1}^{m-1}$。

或者，在总共 $n+m-1$ 个位置中，为 $n$ 个小球或者 $m-1$ 个隔板选择他们的位置，直接变成组合数问题。

如果要求每个盒子必须非空呢？




## 其他排列组合


### 圆排列

从 $n$ 个不同的元素中，选择 $m$ 个，排成一个圆环，圆环内有顺序区别，有多少种不同的方案。

相当于钦定了起点位置的排列，由于一共有 $m$ 个位置，钦定某个元素一定排在起点，其他元素就是普通的排列。

$$
\begin{align}
	ans_{n}^{m} & =\frac{P_{n}^{m}}{m}\nonumber    \\
\end{align}
$$

 $n$ 个元素的圆排列

$$
\begin{align}
	ans_{n}^{n} & =\frac{P_{n}^{n}}{n} \nonumber    \\
	          & = (n-1)!\nonumber
\end{align}
$$

所以也有 $ans_{n}^{n} = P_{n-1}^{n-1}$ 

也可用 Polya 定理获得。

### 错位排列

有 $n$ 个不同的元素，给他们当前的位置编号为 $1,2,3,\cdots,n$ 以区分他们的位置，问有多少种排列方案使得他们不在原来的位置上。或者说，使得第 $i$ 个位置的元素编号不为 $i$ 。

显然，如果只有 $0,1,2$ 个元素，他们的情况是显然的。

考虑新增第 $n(n\geq3)$ 个元素，我们可以任选前面的 $n-1$ 个位置放置它，假设我们选择的是第 $k$ 个位置，再考虑元素 $k$ 如何安放，如果 $k$ 放在第 $n$ 个位置，那么这一对元素的位置要求都已经被满足了，并且对其他元素都没有产生任何影响，问题规模缩减到 $n-2$ ；如果 $k$ 不放在第 $n$ 个位置，那么排除掉已被元素 $n$ 占据的位置 $k$ ，现在还有 $n-1$ 个元素，并且每一个元素都有自己不能去的一个位置（对于 $i\neq k$ 来说，他们不能去位置 $i$ ，而对于元素 $k$ 来说，它不能去位置 $n$ ），这相当于是一个问题规模为 $n-1$ 的问题。这个算法也可以合并到 $n=2$ 的情况上，所以：

$$
D_n = \left \{ 
    \begin{aligned}
&1 &(n = 0)\\ 
&0 & (n=1)\\
&(n-1)(D_{n-1}+D_{n-2})& (n\geq2) 
\end{aligned}
\right. $$

于是得到了一个 $O(n)$ 的递推算法。

另一个计算公式（计算复杂度还更高了，不必要学习）

$$
D_n = \left \{ 
    \begin{aligned}
&1 &(n = 0)\\ 
&0 & (n=1)\\
&n! \sum_{i=2}^{n}\frac{(-1)^k}{k!}& (n\geq2) 
\end{aligned}
\right. $$


### 卡特兰数

### 第一类斯特林数 / 斯特林轮换数

### 第二类斯特林数 / 斯特林子集数

还记得把 $n$ 个相同的小球放到 $m$ 个不同的盒子里的问题吗？这个是用隔板法解决的问题。

其实这个第二类斯特林数比第一类斯特林数常见，也更早被发现。

第二类斯特林数跟这个恰好相反，是把 $n$ 个不同的小球，放到 $m$ 个相同的盒子里，并且每个盒子非空


## 生成函数

生成函数尤其适合用来求解带有奇怪限制条件的组合数问题。

经典的组合数，每个元素选择或者不选择，对应二项式

$$(1+x)$$

如果取 $1 = x^0$ 表示选取 $0$ 个这样的元素。
如果取 $x = x^1$ 表示选取 $1$ 个这样的元素。

假如有 $n$ 个完全一样的元素，从中选择 $m$ 个，那么就相当于 $n$ 个这样的二项式相乘：

$$P(x)=\prod_{i=1}^{n}(1+x)$$

其中 $x^m$ 的项的系数，就是从所有的 $n$ 个二项式中，组合出 $m$ 个 $x$ 和 $n-m$ 个 $1$ 得到的，也就是 $C_n^{m}$ 。

目前看到这里，感觉还是没有什么用处对吧？

对于可重复元素的组合，比如有 $a$ 个元素A， $b$ 个元素B， $c$ 个元素C，从中选出 $m$ 个元素，有多少种组合？

对于元素A，我们可以从中选择 $[0, a]$ 个，对应多项式

$$(1+x+x^2+\cdots+x^a)$$

同理，元素B和元素C的多项式为

$$(1+x+x^2+\cdots+x^b) \\
(1+x+x^2+\cdots+x^c)$$

把他们乘起来，得到

$$P(x)=(1+x+x^2+\cdots+x^a)(1+x+x^2+\cdots+x^b)(1+x+x^2+\cdots+x^c)$$

从中取出 $x^m$ 项的系数，不就相当于从三类物品中总共选出了 $m$ 个物品了吗？

除此之外，生成函数还可以解决很多更奇怪的问题，比如，如果限制元素A的数量只能选择偶数个，那么就是

$$(1+x^2+x^4\cdots+x^{\lfloor\frac{a}{2}\rfloor})$$

同理还能选择奇数个，3的倍数个，5的倍数个等奇怪的限制。

或者偏偏不能选某个数量的，比如我们不喜欢数字4，那么就把 $x^4$ 这一项去掉。

计算这种多项式的方法，需要用到快速傅里叶变换（FFT）。

### 整数分拆

把正整数 $n$ 分解成若干个正整数的加法组合，分解出来的结果是顺序无关的，比如 $5=3+1+1$ 和 $5=1+1+3$ 其实是同样的方案，问有多少种方案。

比如 $4$ 的分拆为：

$$
4 \\
3 + 1 \\
2 + 2 \\
2 + 1 + 1 \\
1 + 1 + 1 + 1 \\
$$

总共5种方案。

特别地，0的分拆方案是只有1种，也就是空。

最简单的解决方法，生成函数！

比如我们要计算 $4$ 的分拆，那么我们考虑，要拆出多少个数字1？

$$(1+x+x^2+x^3+x^4)$$

每选择多一个x，则多拆出一个数字1。

对于数字2，要么不选择，要么一次选2个、4个，还记得前面的只能选偶数的写法吗？

$$(1+x^2+x^4)$$

对于数字3，只能拆出3的倍数。

$$(1+x^3)$$

对于数字4，只有他本身了

$$(1+x^4)$$

把这些全部乘在一起，得到

$$P(x)=(1+x+x^2+x^3+x^4)(1+x^2+x^4)(1+x^3)(1+x^4)$$

其中取出 $x^4$ 的项的系数，即为答案。

生成函数还可以全体乘以、部分乘以 $x$ 或者 $x^{-1}$ 表示添加或者移除某一些元素，具体要看题目的要求，上一次一到CF的题目就是这样。
